<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML to PDF Editor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
   
   
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.2/mammoth.browser.min.js"></script>

   <style>
        body {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            margin: 0;
            padding: 10px;
            font-family: Arial, sans-serif;
        }

        #editor {
            width: 45%;
        }

        #preview {
            width: 45%;
            height: 100vh;
        }

        textarea {
            width: 100%;
            height: 90vh;
            font-family: monospace;
            font-size: 14px;
        }

        iframe {
            width: 100%;
            height: 90vh;
            border: 1px solid #ccc;
        }
    </style>
</head>

<body>
    <div id="editor">
        <h2>HTML Input</h2>
        <textarea id="html-input">

       
       
        </textarea>
        <button id="update-preview">Update PDF Preview :jjdsj </button>
    </div>

    <div id="preview">
        <h2>PDF Preview</h2>
        <iframe id="pdf-frame"></iframe>
    </div>

    <input type="file" id="upload" accept=".docx" />


    <script>
        const { jsPDF } = window.jspdf;

        // document.getElementById('update-preview').addEventListener('click', function () {
        //     const htmlContent = document.getElementById("html-input").value;

            

        //     // Create a hidden div to render the HTML content
        //     const hiddenDiv = document.createElement('div');
        //     hiddenDiv.style.width = '210mm';  // A4 page width
        //     hiddenDiv.style.padding = '20px';
        //     hiddenDiv.innerHTML = htmlContent;
        //     document.body.appendChild(hiddenDiv);

        //     // Use html2canvas to capture the HTML content as an image
        //     html2canvas(hiddenDiv, { useCORS: true, pagesplit: true  }).then(canvas => {
        //         const imgData = canvas.toDataURL("image/png");
        //         console.log("Canvas captured successfully");

        //         // Create a new PDF and add the image
        //         const pdf = new jsPDF();
        //         pdf.addImage(imgData, 'PNG', 0, 0, 210, 297);  // Add image to the PDF
        //         console.log("Image added to PDF");

        //         // Remove the hidden div
        //         document.body.removeChild(hiddenDiv);

        //         // Get PDF as Blob and display in iframe
        //         const pdfBlob = pdf.output('blob');
        //         const pdfUrl = URL.createObjectURL(pdfBlob);
        //         document.getElementById('pdf-frame').src = pdfUrl;
        //         console.log("PDF URL created and set in iframe");
        //     }).catch(err => {
        //         console.error('Error rendering the PDF:', err);
        //     });
        // });





        //fixing  for multiple pages

        document.getElementById('update-preview').addEventListener('click', function () {
            const htmlContent = document.getElementById("html-input").value;

            // Create a hidden div to render the HTML content
            const hiddenDiv = document.createElement('div');
            hiddenDiv.style.width = '210mm';  // A4 page width
            hiddenDiv.style.padding = '20px';
            hiddenDiv.innerHTML = htmlContent;
            document.body.appendChild(hiddenDiv);

            // Use html2canvas to capture the HTML content as an image
            html2canvas(hiddenDiv, { useCORS: true }).then(canvas => {
                const imgData = canvas.toDataURL("image/png");

                // Create a new PDF
                const pdf = new jsPDF('p', 'mm', 'a4');

                const imgWidth = 210; // A4 width
                const pageHeight = 297; // A4 height
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                let heightLeft = imgHeight;

                let position = 0;

                // Add the first image
                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;

                // Add additional pages if content overflows
                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight; // Adjust position for the next page
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight; // Decrease height left by the page height
                }

                // Remove the hidden div
                document.body.removeChild(hiddenDiv);

                // Get PDF as Blob and display in iframe
                const pdfBlob = pdf.output('blob');
                const pdfUrl = URL.createObjectURL(pdfBlob);
                document.getElementById('pdf-frame').src = pdfUrl;
                console.log(8884)
            }).catch(err => {
                console.error('Error rendering the PDF:', err);
            });
        });




        // fix for content does not split



        // document.getElementById('update-preview').addEventListener('click', function () {
        //     const htmlContent = document.getElementById("html-input").value;
        //     console.log(747474747)
        //     // Create a hidden div to render the HTML content
        //     const hiddenDiv = document.createElement('div');
        //     hiddenDiv.style.width = '210mm';  // A4 page width
        //     hiddenDiv.style.padding = '20px';
        //     hiddenDiv.style.display = 'none';  // Hide the div for rendering
        //     hiddenDiv.innerHTML = htmlContent;
        //     document.body.appendChild(hiddenDiv);


        //      let imageString='';
        //     // Use html2canvas to capture the HTML content as an image
        //     html2canvas(hiddenDiv, {
        //         useCORS: true,
        //         onrendered: function (canvas) {
        //             var img = new Image();
        //             img.onload = function () {
        //                 img.onload = null;
        //                 document.body.appendChild(img);
        //             };

        //             img.onerror = function () {
        //                 img.onerror = null;
        //                 if (window.console.log) {
        //                     window.console.log("Not loaded image from canvas.toDataURL");
        //                 } else {
        //                     alert("Not loaded image from canvas.toDataURL");
        //                 }
        //             };

        //             imageString = canvas.toDataURL('image/png');
        //         }


        //     }).then(canvas => {
        //         const imgData = imageString;

        //         // Create a new PDF
        //         const pdf = new jsPDF('p', 'mm', 'a4');

        //         const imgWidth = 210; // A4 width
        //         const pageHeight = 297; // A4 height
        //         const imgHeight = (canvas.height * imgWidth) / canvas.width;

        //         let heightLeft = imgHeight;
        //         let position = 0;

        //         // Add the first image
        //         pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
        //         heightLeft -= pageHeight;

        //         // Add additional pages if content overflows
        //         while (heightLeft >= 0) {
        //             position = heightLeft - imgHeight; // Adjust position for the next page
        //             pdf.addPage();
        //             pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
        //             heightLeft -= pageHeight; // Decrease height left by the page height
        //         }

        //         // Remove the hidden div
        //         document.body.removeChild(hiddenDiv);

        //         // Get PDF as Blob and display in iframe
        //         const pdfBlob = pdf.output('blob');
        //         const pdfUrl = URL.createObjectURL(pdfBlob);
        //         document.getElementById('pdf-frame').src = pdfUrl;
        //     }).catch(err => {
        //         console.error('Error rendering the PDF:', err);
        //     });
        // });





       




//         document.getElementById('update-preview').addEventListener('click', function () {
//     const htmlContent = document.getElementById("html-input").value;

//     // Create a hidden div to render the HTML content
//     const hiddenDiv = document.createElement('div');
//     hiddenDiv.style.width = '210mm';  // A4 page width
//     hiddenDiv.style.padding = '20px';
//     hiddenDiv.innerHTML = htmlContent;
//     document.body.appendChild(hiddenDiv);

//     const opt = {
//         useCORS: true,
//         pagebreak: { mode: ['avoid-all', 'css', 'legacy'] },
//         margin: 1,
//         filename: 'myfile.pdf',
//         image: { type: 'jpeg', quality: 0.98 },
//         html2canvas: { scale: 2.5 },
//         jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' },
//     };
// console.log(76773)
//     // Generate PDF with html2pdf
//     html2pdf()
//         .set(opt)
//         .from(hiddenDiv)
//         .output('blob')  // Get the blob to display in iframe
//         .then(function (pdfBlob) {
//             // Display PDF in the iframe
//             const pdfUrl = URL.createObjectURL(pdfBlob);
//             document.getElementById('pdf-frame').src = pdfUrl;
//             console.log("PDF URL created and set in iframe");

//             // Trigger file download
//             html2pdf().set(opt).from(hiddenDiv).save();

//             // Remove hidden div after generating the PDF
//             document.body.removeChild(hiddenDiv);
//             console.log("PDF generated and hidden div removed");
//         })
//         .catch(err => {
//             console.error('Error rendering the PDF:', err);
//         });
// });
    </script>
</body>

</html>
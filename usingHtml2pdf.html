<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML to PDF Editor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
    <style>
        body {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            margin: 0;
            padding: 10px;
            font-family: Arial, sans-serif;
        }

        #editor {
            width: 45%;
        }

        #preview {
            width: 45%;
            height: 100vh;
        }

        textarea {
            width: 100%;
            height: 90vh;
            font-family: monospace;
            font-size: 14px;
        }

        iframe {
            width: 100%;
            height: 90vh;
            border: 1px solid #ccc;
        }
    </style>
</head>

<body>
    <div id="editor">
        <h2>HTML Inpu vsvsvt</h2>
        <textarea id="html-input">
            <h1 style="text-align:center;">Hello PDF</h1>
            <p>This is a sample HTML input that will be converted into a PDF.</p>
            <p><b>Bold text</b>, <i>italic text</i>, and <u>underlined text</u>.</p>
            <h2 style="text-align:center;">Images</h2>
            <img src="https://images.unsplash.com/photo-1603587630352-897a5b23c218?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=MnwxMTc3NzF8MHwxfGFsbHwxfHx8fHx8fHwxNjIwOTQ5MTA4&ixlib=rb-1.2.1&q=80&w=400" alt="Nature Image" crossOrigin="anonymous" style="border: 1px solid #ccc; display:block; margin: 0 auto;">
        </textarea>
        <button id="update-preview">Update PDF Preview</button>
    </div>

    <div id="preview">
        <h2>PDF Preview</h2>
        <iframe id="pdf-frame"></iframe>
    </div>

    <script>
        function loadImages() {
            const images = Array.from(document.images);
            const promises = images.map((img) => {
                return new Promise((resolve, reject) => {
                    if (img.complete) {
                        resolve(); // Image is already loaded
                    } else {
                        img.onload = resolve;
                        img.onerror = reject;
                    }
                });
            });
            return Promise.all(promises);
        }

        document.getElementById('update-preview').addEventListener('click', function () {
            loadImages().then(() => {
                const htmlContent = document.getElementById("html-input").value;

                // Create a hidden div to render the HTML content
                const hiddenDiv = document.createElement('div');
                hiddenDiv.style.width = '210mm';  // A4 page width
                hiddenDiv.style.padding = '20px';
                hiddenDiv.innerHTML = htmlContent;
                document.body.appendChild(hiddenDiv);

                const opt = {
                    margin: 1,
                    filename: 'myfile.pdf',
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { scale: 2.5 },
                    jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' },
                };

                // Generate PDF with html2pdf
                html2pdf()
                    .set(opt)
                    .from(hiddenDiv)
                    .output('blob')  // Get the blob to display in iframe
                    .then(function (pdfBlob) {
                        // Display PDF in the iframe
                        const pdfUrl = URL.createObjectURL(pdfBlob);
                        document.getElementById('pdf-frame').src = pdfUrl;

                        // Trigger file download
                        html2pdf().set(opt).from(hiddenDiv).save();

                        // Remove hidden div after generating the PDF
                        document.body.removeChild(hiddenDiv);
                    })
                    .catch(err => {
                        console.error('Error rendering the PDF:', err);
                    });
            }).catch(err => console.error('Image loading failed:', err));
        });
    </script>
</body>

</html>